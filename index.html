<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OrienCampus - G√©n√©rateur de CV Moderne</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f9fbfd;
      --card: #ffffff;
      --accent: #007766;
      --accent-dark: #005f4f;
      --accent-2: #2b62ff;
      --muted: #6b7280;
      --border: #eaeef5;
      --success: #10b981;
      --danger: #ef4444;
      --shadow-sm: 0 4px 12px rgba(0,0,0,0.04);
      --shadow-md: 0 6px 20px rgba(16,24,40,0.06);
      --radius: 12px;
      --transition: all 0.25s ease;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: #111;
      line-height: 1.5;
    }

    .wrap {
      max-width: 1080px;
      margin: 24px auto;
      padding: 0 16px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--card);
      padding: 16px 24px;
      border-radius: var(--radius);
      box-shadow: var(--shadow-md);
      margin-bottom: 20px;
    }

    .brand {
      font-weight: 800;
      font-size: 22px;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .controls { display: flex; gap: 12px; align-items: center; }

    button {
      cursor: pointer;
      border: 0;
      padding: 10px 16px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    button:hover { opacity: 0.92; transform: translateY(-1px); }
    button:active { transform: translateY(0); }

    .btn { background: var(--accent); color: white; }
    .btn-outline {
      background: transparent;
      border: 1px solid var(--accent-2);
      color: var(--accent-2);
    }
    .btn-soft {
      background: #f0f9ff;
      color: var(--accent-2);
      border: 1px solid #dbeafe;
    }

    main {
      display: grid;
      grid-template-columns: 1fr 440px;
      gap: 24px;
    }

    .panel {
      background: var(--card);
      padding: 20px;
      border-radius: var(--radius);
      box-shadow: var(--shadow-sm);
    }

    h2 {
      margin: 0 0 16px;
      color: var(--accent);
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .field { margin-bottom: 16px; }
    label {
      display: block;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 8px;
      font-weight: 500;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    textarea,
    select {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font-size: 14px;
      transition: var(--transition);
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(0,119,102,0.15);
    }

    textarea { min-height: 90px; resize: vertical; }

    .row { display: flex; gap: 14px; }
    .small { flex: 1; }

    .list { margin-top: 12px; }
    .item {
      background: #f8fcfa;
      border: 1px solid #e0f0ec;
      padding: 14px;
      border-radius: 10px;
      margin-bottom: 12px;
      position: relative;
      transition: var(--transition);
    }
    .item:hover { background: #f0f9f7; }

    .remove {
      position: absolute;
      right: 12px;
      top: 12px;
      background: var(--danger);
      border: 0;
      color: #fff;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 16px;
    }

    .add {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 10px;
      background: transparent;
      border: 1px dashed #cbdff0;
      padding: 10px 14px;
      border-radius: 8px;
      color: var(--accent-2);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
    }
    .add:hover { background: #f0f9ff; border-style: solid; }

    /* Preview */
    .preview-wrap { position: relative; }
    .preview {
      background: linear-gradient(180deg, #ffffff, #f8fbfa);
      padding: 24px;
      border-radius: var(--radius);
      border: 1px solid #e6eef0;
      min-height: 250px;
      box-shadow: var(--shadow-sm);
    }

    .cv-header {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }

    .photo {
      width: 100px;
      height: 100px;
      border-radius: 12px;
      overflow: hidden;
      border: 2px solid #e0f0ec;
      flex: 0 0 100px;
      background: #f3f7f6;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #9aa6a3;
    }
    .photo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .info h1 {
      margin: 0 0 6px;
      font-size: 22px;
      color: var(--accent);
      font-weight: 700;
    }
    .info p {
      margin: 4px 0;
      color: var(--muted);
      font-size: 14px;
    }

    .section {
      margin-top: 20px;
    }
    .section h3 {
      margin: 0 0 10px;
      color: var(--accent);
      font-size: 14px;
      font-weight: 700;
      letter-spacing: 0.5px;
      padding-bottom: 6px;
      border-bottom: 2px solid rgba(0,119,102,0.12);
    }

    .skill {
      display: inline-block;
      background: #e6f7f3;
      color: var(--accent);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      margin: 4px 8px 4px 0;
      font-weight: 500;
    }

    footer.small {
      margin-top: 20px;
      color: var(--muted);
      font-size: 13px;
      text-align: center;
    }

    @media (max-width: 980px) {
      main { grid-template-columns: 1fr; }
      .preview-wrap { order: -1; margin-bottom: 20px; }
      header { flex-direction: column; gap: 16px; text-align: center; }
    }

    @media (max-width: 600px) {
      .row { flex-direction: column; gap: 12px; }
      .controls { flex-wrap: wrap; justify-content: center; }
    }

    /* Animations */
    .fade-in { animation: fadeIn 0.3s ease forwards; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Loading / Save Feedback */
    .btn-saving {
      background: var(--success);
      color: white;
    }
  </style>
</head>
<body>

<div class="wrap">
  <header>
    <div class="brand">Orien<span style="color:var(--accent-2)">Campus</span></div>
    <div class="controls">
      <button class="btn-soft" id="loadSaved">‚Ü∫ Reprendre</button>
      <button class="btn-outline" id="clearAll">üóëÔ∏è Tout effacer</button>
      <button id="download">üìÑ T√©l√©charger PDF</button>
    </div>
  </header>

  <main>
    <!-- Formulaire -->
    <section class="panel" aria-label="Formulaire de cr√©ation de CV">
      <h2>üë§ Informations personnelles</h2>

      <div class="field row">
        <div style="flex:2">
          <label>Nom complet</label>
          <input id="nom" type="text" placeholder="Ex: Diarra Abdoul Dramane" />
        </div>
        <div style="flex:1">
          <label>Poste vis√©</label>
          <input id="poste" type="text" placeholder="Ex: D√©veloppeur web" />
        </div>
      </div>

      <div class="field row">
        <div class="small">
          <label>üìß Email</label>
          <input id="email" type="email" placeholder="exemple@mail.com" />
        </div>
        <div class="small">
          <label>üìû T√©l√©phone</label>
          <input id="tel" type="tel" placeholder="+226 70 00 00 00" />
        </div>
      </div>

      <div class="field">
        <label>üìç Adresse</label>
        <input id="adresse" type="text" placeholder="Ouagadougou, Burkina Faso" />
      </div>

      <div class="field">
        <label>üì∏ Photo (URL ou fichier)</label>
        <div class="row">
          <input id="photoURL" type="text" placeholder="https://exemple.com/photo.jpg" />
          <input id="photoFile" type="file" accept="image/*" style="padding: 3px;" />
        </div>
        <div style="margin-top:8px; color:var(--muted); font-size:13px">
          L‚Äôimage sera int√©gr√©e directement dans le CV (sauvegard√©e localement).
        </div>
      </div>

      <h2>üéì Parcours scolaire</h2>
      <div class="field">
        <label>√âcole primaire</label>
        <div id="primaireList" class="list"></div>
        <button class="add" onclick="addSchool('primaireList')">‚ûï Ajouter primaire</button>
      </div>

      <div class="field">
        <label>Lyc√©e ‚Äî Premier cycle</label>
        <div id="premierList" class="list"></div>
        <button class="add" onclick="addSchool('premierList')">‚ûï Ajouter 1er cycle</button>
      </div>

      <div class="field">
        <label>Lyc√©e ‚Äî Second cycle</label>
        <div id="secondList" class="list"></div>
        <button class="add" onclick="addSchool('secondList')">‚ûï Ajouter 2nd cycle</button>
      </div>

      <div class="field">
        <label>Universit√© / Institut</label>
        <div id="uniList" class="list"></div>
        <button class="add" onclick="addSchool('uniList')">‚ûï Ajouter universit√©</button>
      </div>

      <h2>üíº Exp√©riences professionnelles</h2>
      <div id="expList" class="list"></div>
      <button class="add" onclick="addExperience()">‚ûï Ajouter une exp√©rience</button>

      <h2>üåü Autres comp√©tences</h2>
      <div class="field">
        <label>Comp√©tences (s√©par√©es par des virgules)</label>
        <input id="skills" type="text" placeholder="HTML, CSS, JavaScript, Laravel, React" />
      </div>
      <div class="field">
        <label>Langues</label>
        <input id="languages" type="text" placeholder="Fran√ßais - Natif, Anglais - Interm√©diaire" />
      </div>
      <div class="field">
        <label>Centres d'int√©r√™t</label>
        <input id="interests" type="text" placeholder="D√©veloppement, Jeux vid√©o, Lecture" />
      </div>

      <div style="display:flex;gap:12px;margin-top:20px">
        <button id="saveBtn" class="btn">üíæ Sauvegarder</button>
        <button id="previewBtn" class="btn btn-outline">üëÅÔ∏è Aper√ßu</button>
      </div>
    </section>

    <!-- Aper√ßu -->
    <aside class="preview-wrap">
      <div class="panel preview" id="previewArea">
        <div id="cvRender" style="opacity:0.01; transition: opacity 0.3s">
          <div style="text-align:center; color:var(--muted); padding: 40px 0;">
            <div style="font-size:48px; margin-bottom:16px;">üìÑ</div>
            Cliquez sur <strong>‚ÄúAper√ßu‚Äù</strong> pour voir votre CV en temps r√©el.
          </div>
        </div>
      </div>

      <div style="margin-top:16px; display:flex; justify-content:space-between; align-items:center; font-size:13px;">
        <span style="color:var(--muted)">Aper√ßu en temps r√©el ¬∑ Donn√©es sauvegard√©es localement</span>
        <button class="btn-soft" id="themeBtn" disabled>üé® Design moderne</button>
      </div>

      <footer class="small">¬© <span id="year"></span> OrienCampus ‚Äî G√©n√©rateur de CV intelligent</footer>
    </aside>
  </main>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
/* ---------- Helpers & State ---------- */
document.getElementById('year').textContent = new Date().getFullYear();
const stateKey = 'oriencampus_cv_v2';
let photoDataURL = null;

function uid(){ return Math.random().toString(36).slice(2,9); }

/* ---------- Add dynamic blocks ---------- */
function createSchoolBlock(sectionId){
  const id = uid();
  const wrapper = document.createElement('div');
  wrapper.className = 'item block-'+id;
  wrapper.innerHTML = `
    <button class="remove" title="Supprimer" onclick="this.parentNode.remove(); saveLocal()">&times;</button>
    <div class="field"><label>√âtablissement</label><input class="etab" placeholder="Nom de l'√©tablissement"></div>
    <div class="row">
      <div class="small"><label>Ville</label><input class="ville" placeholder="Ville"></div>
      <div class="small"><label>Ann√©e / P√©riode</label><input class="annee" placeholder="Ex: 2010 ‚Äì 2016"></div>
    </div>
  `;
  document.getElementById(sectionId).appendChild(wrapper);
  saveLocal();
  return wrapper;
}

function addSchool(sectionId){ createSchoolBlock(sectionId); }

function createExp(){
  const id = uid();
  const wrapper = document.createElement('div');
  wrapper.className = 'item block-'+id;
  wrapper.innerHTML = `
    <button class="remove" title="Supprimer" onclick="this.parentNode.remove(); saveLocal()">&times;</button>
    <div class="field"><label>Poste</label><input class="poste" placeholder="D√©veloppeur backend"></div>
    <div class="field"><label>Entreprise</label><input class="entre" placeholder="Nom de l'entreprise"></div>
    <div class="row">
      <div class="small"><label>Ville</label><input class="eville" placeholder="Ville"></div>
      <div class="small"><label>P√©riode</label><input class="eperiode" placeholder="2020 ‚Äì 2023"></div>
    </div>
    <div class="field"><label>Description (facultatif)</label><textarea class="edesc" placeholder="D√©veloppement d'API REST avec Laravel..."></textarea></div>
  `;
  document.getElementById('expList').appendChild(wrapper);
  saveLocal();
  return wrapper;
}
function addExperience(){ createExp(); }

/* ---------- Save/Load localStorage ---------- */
function gatherData(){
  return {
    nom: document.getElementById('nom').value || '',
    poste: document.getElementById('poste').value || '',
    email: document.getElementById('email').value || '',
    tel: document.getElementById('tel').value || '',
    adresse: document.getElementById('adresse').value || '',
    photoURL: document.getElementById('photoURL').value || '',
    photoDataURL: photoDataURL || null,
    primaire: extractList('primaireList'),
    premier: extractList('premierList'),
    second: extractList('secondList'),
    uni: extractList('uniList'),
    exps: extractExps(),
    skills: document.getElementById('skills').value || '',
    languages: document.getElementById('languages').value || '',
    interests: document.getElementById('interests').value || ''
  };
}

function saveLocal(){
  try{
    const data = gatherData();
    localStorage.setItem(stateKey, JSON.stringify(data));
    const btn = document.getElementById('saveBtn');
    btn.textContent = '‚úÖ Sauvegard√© !';
    btn.classList.add('btn-saving');
    setTimeout(() => {
      btn.textContent = 'üíæ Sauvegarder';
      btn.classList.remove('btn-saving');
    }, 1500);
  }catch(e){ console.error('Erreur sauvegarde', e); }
}

function loadLocal(){
  const raw = localStorage.getItem(stateKey);
  if(!raw) return false;
  try{
    const data = JSON.parse(raw);
    document.getElementById('nom').value = data.nom || '';
    document.getElementById('poste').value = data.poste || '';
    document.getElementById('email').value = data.email || '';
    document.getElementById('tel').value = data.tel || '';
    document.getElementById('adresse').value = data.adresse || '';
    document.getElementById('photoURL').value = data.photoURL || '';
    photoDataURL = data.photoDataURL || null;

    ['primaireList','premierList','secondList','uniList'].forEach(id => {
      document.getElementById(id).innerHTML = '';
    });

    const lists = { primaire: 'primaireList', premier: 'premierList', second: 'secondList', uni: 'uniList' };
    Object.entries(lists).forEach(([key, id]) => {
      if (Array.isArray(data[key])) data[key].forEach(item => {
        const node = createSchoolBlock(id);
        node.querySelector('.etab').value = item.etab || '';
        node.querySelector('.ville').value = item.ville || '';
        node.querySelector('.annee').value = item.annee || '';
      });
    });

    document.getElementById('expList').innerHTML = '';
    if(Array.isArray(data.exps)) data.exps.forEach(e=>{
      const node = createExp();
      node.querySelector('.poste').value = e.poste || '';
      node.querySelector('.entre').value = e.entre || '';
      node.querySelector('.eville').value = e.ville || '';
      node.querySelector('.eperiode').value = e.periode || '';
      node.querySelector('.edesc').value = e.desc || '';
    });

    document.getElementById('skills').value = data.skills || '';
    document.getElementById('languages').value = data.languages || '';
    document.getElementById('interests').value = data.interests || '';
    return true;
  }catch(e){ console.error(e); return false; }
}

function extractList(sectionId){
  const arr=[];
  document.querySelectorAll(`#${sectionId} .item`).forEach(n=>{
    arr.push({
      etab: n.querySelector('.etab')?.value||'',
      ville: n.querySelector('.ville')?.value||'',
      annee: n.querySelector('.annee')?.value||''
    });
  });
  return arr;
}
function extractExps(){
  const arr=[];
  document.querySelectorAll('#expList .item').forEach(n=>{
    arr.push({
      poste: n.querySelector('.poste')?.value||'',
      entre: n.querySelector('.entre')?.value||'',
      ville: n.querySelector('.eville')?.value||'',
      periode: n.querySelector('.eperiode')?.value||'',
      desc: n.querySelector('.edesc')?.value||''
    });
  });
  return arr;
}

/* ---------- Photo handling ---------- */
document.getElementById('photoFile').addEventListener('change', (e)=>{
  const f = e.target.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = function(evt){
    photoDataURL = evt.target.result;
    saveLocal();
    renderPreview();
  };
  reader.readAsDataURL(f);
});

document.getElementById('photoURL').addEventListener('input', saveLocal);

/* ---------- Render Preview ---------- */
function renderPreview(){
  const data = gatherData();
  const imageSrc = data.photoDataURL || (data.photoURL ? data.photoURL : null);
  const cv = document.getElementById('cvRender');
  let html = '';

  html += `<div class="cv-header fade-in">`;
  html += `<div class="photo">${ imageSrc ? `<img src="${escapeHtml(imageSrc)}" alt="Photo">` : '<div>üì∏</div>' }</div>`;
  html += `<div class="info">`;
  html += `<h1>${escapeHtml(data.nom || '')}</h1>`;
  html += `<p><strong>${escapeHtml(data.poste||'')}</strong></p>`;
  if(data.email || data.tel) {
    html += `<p style="color:var(--muted); font-size:14px;">${escapeHtml(data.email||'')}${data.tel ? ' ‚Ä¢ '+escapeHtml(data.tel):''}</p>`;
  }
  if(data.adresse) html += `<p style="color:var(--muted); font-size:14px;">${escapeHtml(data.adresse)}</p>`;
  html += `</div></div>`;

  function renderSchool(title, arr){
    if(!arr || !arr.length) return '';
    let s = `<div class="section"><h3>${escapeHtml(title)}</h3>`;
    arr.forEach(it=>{
      if(!it.etab && !it.annee && !it.ville) return;
      s += `<div style="margin-bottom:8px"><strong>${escapeHtml(it.etab||'')}</strong>`;
      if(it.ville) s += ` ‚Äî ${escapeHtml(it.ville)}`;
      if(it.annee) s += ` <span style="color:var(--muted); font-size:13px;">${escapeHtml(it.annee)}</span>`;
      s += `</div>`;
    });
    s += `</div>`;
    return s;
  }

  html += renderSchool('√âcole primaire', data.primaire);
  html += renderSchool('Lyc√©e ‚Äî Premier cycle', data.premier);
  html += renderSchool('Lyc√©e ‚Äî Second cycle', data.second);
  html += renderSchool('Universit√© / Institut', data.uni);

  if(data.exps && data.exps.length){
    html += `<div class="section"><h3>Exp√©riences professionnelles</h3>`;
    data.exps.forEach(e=>{
      if(!e.poste && !e.entre) return;
      html += `<div style="margin-bottom:12px"><strong>${escapeHtml(e.poste||'')}</strong> ‚Äî <em>${escapeHtml(e.entre||'')}</em>`;
      if(e.periode) html += ` <span style="color:var(--muted); font-size:13px;">(${escapeHtml(e.periode)})</span>`;
      if(e.desc) html += `<div style="font-size:13px; color:var(--muted); margin-top:6px; line-height:1.5;">${escapeHtml(e.desc)}</div>`;
      html += `</div>`;
    });
    html += `</div>`;
  }

  const skills = (data.skills || '').split(',').map(s=>s.trim()).filter(Boolean);
  if(skills.length){
    html += `<div class="section"><h3>Comp√©tences</h3>`;
    skills.forEach(s => html += `<span class="skill">${escapeHtml(s)}</span>`);
    html += `</div>`;
  }

  if(data.languages){
    html += `<div class="section"><h3>Langues</h3><p>${escapeHtml(data.languages)}</p></div>`;
  }
  if(data.interests){
    html += `<div class="section"><h3>Centres d'int√©r√™t</h3><p>${escapeHtml(data.interests)}</p></div>`;
  }

  cv.innerHTML = html;
  cv.style.opacity = 1;
}

function escapeHtml(str){
  if(str === null || str === undefined) return '';
  return String(str)
    .replaceAll('&','&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;')
    .replaceAll("'",'&#039;');
}

/* ---------- Buttons ---------- */
document.getElementById('saveBtn').addEventListener('click', saveLocal);
document.getElementById('previewBtn').addEventListener('click', ()=>{
  renderPreview();
  saveLocal();
});
document.getElementById('loadSaved').addEventListener('click', ()=>{
  const ok = loadLocal();
  if(!ok) alert('Aucune sauvegarde trouv√©e.');
  else { renderPreview(); }
});
document.getElementById('clearAll').addEventListener('click', ()=>{
  if(confirm('√ätes-vous s√ªr de vouloir supprimer toutes vos donn√©es ? Cette action est irr√©versible.')) {
    localStorage.removeItem(stateKey);
    location.reload();
  }
});

/* ---------- Download PDF ---------- */
document.getElementById('download').addEventListener('click', ()=>{
  renderPreview();
  const element = document.getElementById('cvRender');
  const opt = {
    margin: 0.5,
    filename: `CV-${(document.getElementById('nom').value || 'utilisateur').replaceAll(' ','_')}.pdf`,
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2, useCORS: true, backgroundColor: '#ffffff' },
    jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
  };
  html2pdf().set(opt).from(element).save();
});

/* ---------- Auto-save on change ---------- */
['nom','poste','email','tel','adresse','photoURL','skills','languages','interests']
.forEach(id => {
  const el = document.getElementById(id);
  el?.addEventListener('input', () => { 
    clearTimeout(window._sv); 
    window._sv = setTimeout(saveLocal, 800); 
  });
});

/* ---------- Initial load ---------- */
(function init(){
  const hasData = loadLocal();
  ['primaireList','premierList','secondList','uniList','expList'].forEach(id=>{
    if(document.getElementById(id).children.length === 0){
      if(id === 'expList') createExp();
      else createSchoolBlock(id);
    }
  });
  if(hasData) renderPreview();
})();
</script>

</body>
</html>
